<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rail Horizon: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rail Horizon
   </div>
   <div id="projectbrief">ROS2 Node that provides a map and mission foresight in form of a ROS Message</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Rail Horizon Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Rail Horizon</h1>
<p>Rail Horizon is a ROS2 Node which provides train map foresight (an excerpt of digital map data) by processing mission profile, map regions and coupled localization data. The train map foresight is provided in a form of a ROS Message called RailHorizonStamped, containing the map data in a local sensor coordinate system and global coordinate system.</p>
<p><img src="rviz_RH.png" alt="" class="inline" title="Rviz"/></p>
<h2><a class="anchor" id="autotoc_md1"></a>
Build</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Cloning and Submodules</h3>
<p>First clone the project (ssh recommended) and in case of ssh add some replacement patterns, so submodules will be converted to ssh: </p><div class="fragment"><div class="line">git config --global url.&quot;git@github.com:&quot;.insteadOf &quot;https://github.com/&quot;</div>
</div><!-- fragment --><p>Then initialize all submodules recursively: </p><div class="fragment"><div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3"></a>
Dependencies</h3>
<p>Dependencies (Recommended: Ubuntu 22.04):</p><ul>
<li><a href="https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html">ROS2 Humble</a></li>
<li>Python: <code>sudo apt install python</code></li>
<li>Boost: <code>sudo apt install libboost-all-dev</code></li>
<li>Proj: <code>sudo apt install libproj-dev</code></li>
<li>Protobuf (Map Service): <code>sudo apt install libprotobuf-dev protobuf-compiler</code></li>
<li>Curl (Map Service): <code>sudo apt install libcurl4-openssl-dev</code></li>
</ul>
<p>You should also create the underlay, which is the underlying workspace with ROS2 Tools available. It behaves similarly to a virtual environment and allows having multiple ROS2 versions installed on the system and use a specific one for each project. The underlay can be created automatically for every terminal session or manually at the beginning of a new session like this: </p><div class="fragment"><div class="line">source /opt/ros/humble/setup.bash</div>
</div><!-- fragment --><p>Check if all dependencies are available with: </p><div class="fragment"><div class="line">rosdep install -i --from-path src --rosdistro humble -y</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md4"></a>
Preparation</h3>
<p>Some environment variables need to be set for the map service: </p><div class="fragment"><div class="line">export RMW_IMPLEMENTATION=rmw_fastrtps_cpp</div>
<div class="line">export PERSISTENT_STORAGE_ROOT_DIR=~/documents/maps</div>
<div class="line">export DB_MAP_VERSION=12</div>
<div class="line">export DB_MAP_ENDPOINT=DBMC</div>
<div class="line">export DB_MAP_CATALOG=validate.s4r2.oss.4</div>
</div><!-- fragment --><ul>
<li>They can be set for a terminal session, loaded automatically in <code>~/.bashrc</code> (Don't forget to source the file: <code>source ~/.bashrc</code>) or globally for all sessions and users in <code>etc/environment</code> (Syntax is different)</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
Build</h3>
<p>Use colcon build to build the project. Some variables are specified, which are needed for the projects. As in CMake, they only have to specified once for each build directory as they are cached:</p>
<div class="fragment"><div class="line">export CMAKE_BUILD_PARALLEL_LEVEL=10</div>
<div class="line">colcon build --base-paths src --cmake-args -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON --event-handlers console_cohesion+ --packages-up-to dsd_rail_horizon</div>
</div><!-- fragment --><ul>
<li><code>-DCMAKE_EXPORT_COMPILE_COMMANDS=ON</code> is optional. It generates a compilation database for tooling. For instance, clang-tidy needs it, which is run as a pre-commit.</li>
<li><code>-G Ninja</code> can optionally be added to the <code>--cmake-args</code>. If the <code>ninja</code> build system is installed on the system, it can be used instead of make. Builds usually are a lot faster then.</li>
</ul>
<p>After the build, you should source the install folder: </p><div class="fragment"><div class="line">source ./install/local_setup.bash</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md6"></a>
Run</h3>
<p>Currently, Rail Horizon supports one map region of interest (roi) which is given in the parameters.yaml configuration file. Rail Horizon can be run with the config file specified on the command line.</p>
<div class="fragment"><div class="line">ros2 run dsd_rail_horizon dsd_rail_horizon --ros-args --params-file ./install/dsd_rail_horizon/config/dsd_rail_horizon/parameters.yaml</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Test</h3>
<p>Run all tests: </p><div class="fragment"><div class="line">ctest --test-dir build/dsd_rail_horizon --output-on-failure</div>
</div><!-- fragment --><p>Run all C++ unit tests: </p><div class="fragment"><div class="line">ctest --test-dir build/dsd_rail_horizon -L &quot;UnitTests&quot; --output-on-failure</div>
</div><!-- fragment --><p>Run all Python integration tests: </p><div class="fragment"><div class="line">ctest --test-dir build/dsd_rail_horizon -L &quot;IntegrationTests&quot; --output-on-failure</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md8"></a>
Coverage</h4>
<p>Generate coverage report with: </p><div class="fragment"><div class="line">gcovr --exclude-unreachable-branches --exclude-throw-branches -r . --filter src/ --exclude &#39;.*tests/&#39; --html --html-details -o build/coverage.html</div>
</div><!-- fragment --><p>The generated file <code>build/coverage.html</code> contains the report.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Development Tools</h3>
<p>Dependencies:</p><ul>
<li><a href="https://pre-commit.com/">pre-commit ^3.2</a>: <code>sudo apt install pre-commit</code></li>
<li><a href="https://clang.llvm.org/docs/ClangFormat.html">clang-format ^14.0</a>: <code>sudo apt install clang-format</code> (or: <code>pipx install clang-format</code>)</li>
<li><a href="https://clang.llvm.org/extra/clang-tidy/">clang-tidy ^14.0</a>: <code>sudo apt install clang-tidy</code></li>
<li><a href="https://include-what-you-use.org/">include-what-you-use ^0.17</a> (<b>optional</b>, see below): <code>sudo apt install iwyu</code></li>
</ul>
<h4><a class="anchor" id="autotoc_md10"></a>
Pre-Commit</h4>
<p>We use <a href="https://pre-commit.com/">pre-commit</a> to enforce usage of tools such as clang-format on commit. This ensures that tools such as clang-format are run on a commit, and thus keeps our repository consistent and makes review easier.</p>
<p>Install all the hooks with: </p><div class="fragment"><div class="line">pre-commit install</div>
</div><!-- fragment --><p>Pre-commit will be then automatically run on changed files in a commit. Additionally, it can also be run manually against all files with: </p><div class="fragment"><div class="line">pre-commit run --all-files</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md11"></a>
include-what-you-use (optional, experimental)</h4>
<p>The tool <a href="https://include-what-you-use.org/">include-what-you-use</a> can help to find the right includes. This makes dependencies obvious and avoids transitive includes, which are bad practice. The setup of the tool is more involved and additionally the output of the tool is not yet perfect and requires tweaking. For these reasons, the tool should be run only manually after other changes have been committed, and the output should be carefully reviewed.</p>
<p>As include-what-you-use is basically built on top of some specific clang version, the development header should be installed: </p><div class="fragment"><div class="line">sudo apt install libclang-common-13-dev</div>
</div><!-- fragment --><ul>
<li>The clang version can be found out with <code>strings /usr/bin/iwyu | grep LLVM</code>. On Ubuntu 22.04 this gives <code>LLVM_13</code>.</li>
</ul>
<p>The tool can be run as a manual pre-commit job: </p><div class="fragment"><div class="line">pre-commit run --hook-stage manual include-what-you-use --all-files</div>
</div><!-- fragment --><ul>
<li>Note: This will also automatically apply clang format to fix the order of includes</li>
</ul>
<p>The configuration of the command line arguments can be found in <code>tools/iwyu_precommit.py</code>. Additionally, we use mostly automatically generated <a href="https://github.com/include-what-you-use/include-what-you-use/blob/master/docs/IWYUMappings.md">mapping</a> files. If <code>iwyu</code> suggest using the wrong header (for instance some internal header file, which is not supposed to be used) then likely adjustments need to be made to the mapping file. In this case, make the appropriate changes to <code>tools/generate_mappings.py</code>. The mappings will be automatically created by the precommit in <code>build/iwyu_mappings</code>. Additionally, some <a href="https://github.com/include-what-you-use/include-what-you-use/blob/master/docs/IWYUPragmas.md">pragmas</a> can be used as well to fix the output. Or changes can be manually overwritten.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Licenses</h2>
<p>This project is compliant with the <a href="https://git.fsfe.org/reuse/docs/src/commit/d173a27231a36e1a2a3af07421f5e557ae0fec46/spec.md">REUSE Specification Version 3.0</a></p>
<p>Copyright DB Netz AG, licensed under Apache 2.0 (see full text in <a href="./LICENSES/Apache-2.0.txt">LICENSES/Apache-2.0.txt</a>)</p>
<p>Dot-files, cmake-files and config-files are licensed under CC0-1.0 (see full text in <a href="./LICENSES/CC0-1.0.txt">LICENSES/CC0-1.0.txt</a>) </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
